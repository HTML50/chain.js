<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>chain.js</title>
<style>
img{
width:300px;
height:388px;
padding:10px;
-webkit-filter:blur(6px);
filter:blur(6px);
transition:-webkit-filter 1.5s;
transition:filter 1.5s;
}

list{
display:block;
margin-top:50px;
text-align:center;
}

#loading{
opacity:0;
transition:opacity .5s;
font-size:30px;
}

#loading:after{
content:'.';
animation: blinking 2s linear infinite;
}

@keyframes blinking {
	50% {
		content: '..';
	}

	100% {
		content: '...';
	}
}


</style>
</head>
<body>
<center><input type="button" value="读取图片" onclick="begin()">
<p id="loading">读取中</p></center>
<list>
<img src="1_preview.jpg">
<img src="2_preview.jpg">
<img src="3_preview.jpg">
<img src="4_preview.jpg">
</list>

<script>

var toBeDownloaded=["1.jpg","2.jpg","3.jpg","4.jpg"];
var job;



function begin(){
job=new Chain();
loading.style.opacity=1;
for(i=0;i<toBeDownloaded.length;i++){
job.add(function(k){
  return new Function('ajax({\
    url:toBeDownloaded['+k+'],\
    success:setIMG('+k+',toBeDownloaded['+k+'])\
    });')
}(i));
}
job.add(function(){loading.innerText = '读取完毕';})
job.add(finished)
job.start();
}

function setIMG(index,src){
var imgs = document.getElementsByTagName('img');
loading.innerText = '读取第'+(index+1)+'张图片';
imgs[index].src=src;
imgs[index].style.filter='blur(0px)';
}

function finished(){
setTimeout('loading.style.opacity=0',1000);
}


</script>
<script src="chain.js"></script>
</body>
</html>